<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QuantumClash - Gun & Melee Edition</title>
  <meta name="viewport" content="width=800, initial-scale=1">
  <!-- Phaser CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body { background: #191b1f; color: #fff; margin: 0;}
    #gameContainer { margin: 0 auto; width: 800px; height: 600px; }
    h1 { text-align: center; font-family: Arial, sans-serif; margin: 20px 0 10px 0; }
    .credit { text-align: center; margin-bottom: 8px; color: #aaa; }
  </style>
</head>
<body>
  <h1>QuantumClash: Gun & Melee Edition</h1>
  <div class="credit">by shivamgamingwithlokicraft-stack &bull; <a href="https://phaser.io/" style="color:#89f" target="_blank">Phaser.js</a></div>
  <div id="gameContainer"></div>
  <script>
class QuantumClash extends Phaser.Scene {
    preload() {
        // Placeholder spritesheets & images (public domain/CC0)
        this.load.spritesheet('fighter1', 'https://opengameart.org/sites/default/files/Green-Cap-Character-16x18.png', { frameWidth: 16, frameHeight: 18 });
        this.load.spritesheet('fighter2', 'https://opengameart.org/sites/default/files/ManBlue_0.png', { frameWidth: 16, frameHeight: 18 });
        this.load.image('bullet', 'https://opengameart.org/sites/default/files/laserBlue01.png');
        this.load.image('gun', 'https://opengameart.org/sites/default/files/gun_0.png');
        this.load.image('arena1', 'https://opengameart.org/sites/default/files/arena_tile.png');
        this.load.image('arena2', 'https://opengameart.org/sites/default/files/tundra_tile_0.png');
        this.load.image('powerup', 'https://opengameart.org/sites/default/files/coinGold_0.png');
        this.load.image('explosion', 'https://opengameart.org/sites/default/files/explosion1_0.png');
        // Placeholder sounds (freesound.org, CC0)
        this.load.audio('shoot', 'https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa1f28.mp3');
        this.load.audio('punch', 'https://cdn.pixabay.com/audio/2022/03/15/audio_115b9e2b3c.mp3');
    }

    create() {
        // Level system for 10+ minutes
        this.level = 1;
        this.wave = 1;
        this.maxLevels = 5;
        this.timer = this.time.addEvent({ delay: 150000, callback: this.nextLevel, callbackScope: this }); // 2.5 min per level

        // Arena
        this.arena = this.add.image(400, 300, 'arena1').setScale(50);

        // Players (2-player local)
        this.player1 = this.physics.add.sprite(200, 400, 'fighter1').setCollideWorldBounds(true).setScale(3);
        this.player2 = this.physics.add.sprite(600, 400, 'fighter2').setCollideWorldBounds(true).setScale(3);
        this.player1.hasGun = true;
        this.player2.hasGun = true;

        // Animations
        this.anims.create({ key: 'idle1', frames: this.anims.generateFrameNumbers('fighter1', { start: 0, end: 3 }), frameRate: 6, repeat: -1 });
        this.anims.create({ key: 'shoot1', frames: this.anims.generateFrameNumbers('fighter1', { start: 4, end: 5 }), frameRate: 8 });
        this.anims.create({ key: 'idle2', frames: this.anims.generateFrameNumbers('fighter2', { start: 0, end: 3 }), frameRate: 6, repeat: -1 });
        this.player1.play('idle1');
        this.player2.play('idle2');

        // Guns and bullets
        this.bullets1 = this.physics.add.group();
        this.bullets2 = this.physics.add.group();
        this.gun1 = this.add.image(this.player1.x + 20, this.player1.y, 'gun').setScale(2).setDepth(2);
        this.gun2 = this.add.image(this.player2.x - 20, this.player2.y, 'gun').setScale(2).setDepth(2);

        // Enemies (waves)
        this.enemies = this.physics.add.group();
        this.spawnWave();

        // Health/Power
        this.health1 = 100;
        this.health2 = 100;
        this.power1 = 0;
        this.power2 = 0;
        this.healthBar1 = this.add.graphics().fillStyle(0x00ff00).fillRect(50, 50, 200, 20);
        this.powerBar1 = this.add.graphics().fillStyle(0x0000ff).fillRect(50, 80, 0, 10);
        this.healthBar2 = this.add.graphics().fillStyle(0x00ff00).fillRect(550, 50, 200, 20);
        this.powerBar2 = this.add.graphics().fillStyle(0x0000ff).fillRect(550, 80, 0, 10);

        // Controls (expanded for 2 players)
        this.keys1 = this.input.keyboard.addKeys('W,S,A,D,J,K,L'); // Player1
        this.keys2 = this.input.keyboard.addKeys('UP,DOWN,LEFT,RIGHT,NUMPAD_ZERO,NUMPAD_ONE,NUMPAD_TWO'); // Player2

        // Power-ups
        this.powerups = this.physics.add.group();
        this.time.addEvent({ delay: 10000, callback: () => {
            let powerup = this.powerups.create(Phaser.Math.Between(100, 700), 100, 'powerup');
            powerup.setVelocityY(50);
        }, loop: true });

        // Collisions
        this.physics.add.collider(this.bullets1, this.enemies, this.hitEnemy, null, this);
        this.physics.add.collider(this.bullets2, this.enemies, this.hitEnemy, null, this);
        this.physics.add.overlap(this.player1, this.powerups, (p, pu) => this.collectPowerup(p, pu, 1));
        this.physics.add.overlap(this.player2, this.powerups, (p, pu) => this.collectPowerup(p, pu, 2));

        // Particles
        this.particles = this.add.particles('explosion');
        this.emitter = this.particles.createEmitter({ speed: 100, scale: { start: 1, end: 0 }, blendMode: 'ADD' });

        // Sound
        this.shootSound = this.sound.add('shoot');
        this.punchSound = this.sound.add('punch');

        // UI
        this.levelText = this.add.text(400, 20, 'Level 1 - Wave 1', { fontSize: '24px', fill: '#fff' }).setOrigin(0.5);
    }

    update() {
        // Player1 controls
        if (this.keys1.A.isDown) this.player1.x -= 5;
        if (this.keys1.D.isDown) this.player1.x += 5;
        if (this.keys1.W.isDown && this.player1.body.touching.down) this.player1.setVelocityY(-200);
        if (Phaser.Input.Keyboard.JustDown(this.keys1.J)) this.shootBullet(this.player1, this.bullets1, 1);
        if (Phaser.Input.Keyboard.JustDown(this.keys1.K)) this.meleeAttack(this.player1, 1);

        // Player2 controls
        if (this.keys2.LEFT.isDown) this.player2.x -= 5;
        if (this.keys2.RIGHT.isDown) this.player2.x += 5;
        if (this.keys2.UP.isDown && this.player2.body.touching.down) this.player2.setVelocityY(-200);
        if (Phaser.Input.Keyboard.JustDown(this.keys2.NUMPAD_ZERO)) this.shootBullet(this.player2, this.bullets2, 2);
        if (Phaser.Input.Keyboard.JustDown(this.keys2.NUMPAD_ONE)) this.meleeAttack(this.player2, 2);

        // Update guns
        this.gun1.setPosition(this.player1.x + 20, this.player1.y);
        this.gun2.setPosition(this.player2.x - 20, this.player2.y);

        // Enemy AI
        this.enemies.children.iterate((enemy) => {
            if (enemy.x < this.player1.x) enemy.x += 2;
            else enemy.x -= 2;
            if (Math.random() < 0.01) this.enemyAttack(enemy);
        });

        // Win/Lose
        if (this.health1 <= 0 || this.health2 <= 0) this.gameOver();
        if (this.enemies.countActive() === 0) this.nextWave();
    }

    shootBullet(player, bullets, playerNum) {
        if (!player.hasGun) return;
        this.shootSound.play();
        player.play('shoot1');
        let bullet = bullets.create(player.x, player.y, 'bullet').setScale(2);
        bullet.setVelocityX(playerNum === 1 ? 300 : -300);
        bullet.playerNum = playerNum;
    }

    meleeAttack(player, playerNum) {
        this.punchSound.play();
        this.enemies.children.iterate((enemy) => {
            if (Phaser.Math.Distance.Between(player.x, player.y, enemy.x, enemy.y) < 50) {
                enemy.health -= 20;
                if (enemy.health <= 0) enemy.destroy();
            }
        });
    }

    hitEnemy(bullet, enemy) {
        bullet.destroy();
        enemy.health -= 30;
        this.emitter.explode(10, enemy.x, enemy.y);
        if (enemy.health <= 0) enemy.destroy();
    }

    enemyAttack(enemy) {
        // Enemy shoots or punches
        let target = Phaser.Math.RND.pick([this.player1, this.player2]);
        if (Phaser.Math.Distance.Between(enemy.x, enemy.y, target.x, target.y) < 100) {
            if (target === this.player1) this.health1 -= 10;
            else this.health2 -= 10;
            this.updateBars();
        }
    }

    collectPowerup(player, powerup, playerNum) {
        powerup.destroy();
        if (playerNum === 1) this.power1 += 20;
        else this.power2 += 20;
        this.updateBars();
    }

    spawnWave() {
        for (let i = 0; i < this.wave * 2; i++) {
            let enemy = this.enemies.create(Phaser.Math.Between(100, 700), 100, 'fighter2').setScale(3);
            enemy.health = 50;
            enemy.setVelocityY(50);
        }
    }

    nextWave() {
        this.wave++;
        if (this.wave > 3) this.nextLevel();
        else {
            this.spawnWave();
            this.levelText.setText(`Level ${this.level} - Wave ${this.wave}`);
        }
    }

    nextLevel() {
        this.level++;
        this.wave = 1;
        if (this.level > this.maxLevels) {
            this.add.text(400, 300, 'Victory! Total Time: 10+ Minutes', { fontSize: '48px' }).setOrigin(0.5);
            this.showFact();
        } else {
            this.arena.setTexture('arena2'); // Change arena
            this.spawnWave();
            this.levelText.setText(`Level ${this.level} - Wave 1`);
            this.timer.reset({ delay: 150000, callback: this.nextLevel, callbackScope: this });
        }
    }

    gameOver() {
        this.add.text(400, 300, 'Game Over!', { fontSize: '48px', fill: '#ff0000' }).setOrigin(0.5);
    }

    updateBars() {
        this.healthBar1.clear().fillStyle(this.health1 > 50 ? 0x00ff00 : 0xffff00).fillRect(50, 50, this.health1 * 2, 20);
        this.powerBar1.clear().fillStyle(0x0000ff).fillRect(50, 80, this.power1 * 2, 10);
        this.healthBar2.clear().fillStyle(this.health2 > 50 ? 0x00ff00 : 0xffff00).fillRect(550, 50, this.health2 * 2, 20);
        this.powerBar2.clear().fillStyle(0x0000ff).fillRect(550, 80, this.power2 * 2, 10);
    }

    showFact() {
        const facts = [
            \"Projectile motion: Guns follow parabolic paths due to gravity!\",
            \"Fighting physics: Momentum in punches = mass x velocity.\",
            \"History: Ancient warriors used ranged weapons like bows.\"
        ];
        this.add.text(400, 350, Phaser.Utils.Array.GetRandom(facts), { fontSize: '24px' }).setOrigin(0.5);
    }
}

const config = {
    type: Phaser.AUTO,
    parent: 'gameContainer',
    width: 800,
    height: 600,
    physics: { default: 'arcade', arcade: { gravity: { y: 300 } } },
    scene: QuantumClash
};

new Phaser.Game(config);
  </script>
  <div style="text-align:center;margin:24px 0;">
    <a href="https://phaser.io/" target="_blank" style="color:#99f;">Made with Phaser.js</a>
  </div>
</body>
</html>
